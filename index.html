<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡Šæ”¾æƒè¯ Demo - JunYou SDK</title>
    <!-- å¼•å…¥ JunYou H5 SDK -->
    <script src="https://open-sdk.junyouchain.com/jysdk-h5-0.0.1.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #667eea;
            margin-right: 10px;
            border-radius: 2px;
        }

        .info-item {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .label {
            font-size: 14px;
            color: #666;
            min-width: 120px;
            font-weight: 500;
        }

        .value {
            font-size: 14px;
            color: #333;
            flex: 1;
            word-break: break-all;
        }

        .input-field {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            color: #333;
            background: #fff;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-field::placeholder {
            color: #999;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin: 30px 0;
        }

        .btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .result-box {
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .result-box.success {
            background: #e8f5e9;
            border: 2px solid #4caf50;
        }

        .result-box.error {
            background: #ffebee;
            border: 2px solid #f44336;
        }

        .result-item {
            margin-bottom: 12px;
        }

        .result-item:last-child {
            margin-bottom: 0;
        }

        .result-item .label {
            color: #333;
        }

        .result-item .value {
            font-weight: 600;
        }

        .result-box.success .result-item .value {
            color: #2e7d32;
        }

        .result-box.error .result-item .value {
            color: #c62828;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #fff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-size: 14px;
        }

        .step-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            font-size: 14px;
            color: #666;
        }

        .step-indicator .step {
            display: flex;
            align-items: center;
            margin-right: 15px;
        }

        .step-indicator .step-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
        }

        .step-indicator .step.active .step-number {
            background: #4caf50;
            animation: pulse 1.5s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .console-log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .console-log .log-item {
            margin-bottom: 8px;
            padding: 4px 0;
        }

        .console-log .log-time {
            color: #858585;
            margin-right: 8px;
        }

        .console-log .log-info {
            color: #4ec9b0;
        }

        .console-log .log-success {
            color: #4ec9b0;
        }

        .console-log .log-error {
            color: #f48771;
        }

        .flow-guide {
            margin-bottom: 30px;
        }

        .flow-step {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .flow-step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .flow-step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            margin-right: 12px;
        }

        .flow-step-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .flow-detail {
            margin-top: 15px;
        }

        .flow-detail-item {
            margin-bottom: 12px;
        }

        .flow-detail-label {
            font-size: 13px;
            color: #666;
            font-weight: 600;
            margin-bottom: 6px;
            display: block;
        }

        .flow-detail-value {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #333;
            word-break: break-all;
            white-space: pre-wrap;
            border-left: 3px solid #667eea;
        }

        .flow-detail-value code {
            background: transparent;
            padding: 0;
            color: #667eea;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ é‡Šæ”¾æƒè¯ Demo</h1>
            <p>JunYou SDK - ReleaseWarrant åŠŸèƒ½æ¼”ç¤º</p>
            <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
                <span id="apiStatus" style="padding: 4px 8px; background: rgba(255,255,255,0.2); border-radius: 4px;">
                    æ£€æŸ¥åç«¯è¿æ¥...
                </span>
            </div>
        </div>

        <div class="content">
            <!-- æµç¨‹è¯´æ˜ -->
            <div class="section flow-guide">
                <div class="section-title">ğŸ“‹ æµç¨‹è¯´æ˜</div>
                
                <!-- æ­¥éª¤0ï¼šSDKåˆå§‹åŒ– -->
                <div class="flow-step">
                    <div class="flow-step-header">
                        <div class="flow-step-number">0</div>
                        <div class="flow-step-title">SDK åˆå§‹åŒ–ï¼ˆé¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œï¼‰</div>
                    </div>
                    <div class="flow-detail">
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">è¯´æ˜ï¼š</span>
                            <div class="flow-detail-value">é¡µé¢åŠ è½½æ—¶ä¼šè‡ªåŠ¨åˆå§‹åŒ– JunYou SDKï¼ŒSDK åœ¨éœ€è¦ç­¾åæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨åç«¯æ¥å£è·å–ç­¾åå’Œ OpenAuthã€‚</div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">æ¥å£ï¼š</span>
                            <div class="flow-detail-value">POST <code>http://localhost:8080/api/signature-with-open-auth</code></div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">è°ƒç”¨æ—¶æœºï¼š</span>
                            <div class="flow-detail-value">å½“ SDK éœ€è¦ç­¾åæ—¶è‡ªåŠ¨è°ƒç”¨ï¼ˆä¾‹å¦‚è°ƒç”¨ ReleaseWarrant æ–¹æ³•æ—¶ï¼‰</div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">è¯·æ±‚å‚æ•°ï¼š</span>
                            <div class="flow-detail-value">{
  "method": "POST",  //HTTPæ–¹æ³•ï¼ˆç”±SDKè‡ªåŠ¨ä¼ å…¥ï¼‰
  "path": "/api/..." //APIè·¯å¾„ï¼ˆç”±SDKè‡ªåŠ¨ä¼ å…¥ï¼‰
}</div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">è¿”å›æ•°æ®ï¼š</span>
                            <div class="flow-detail-value">{
  "code": 200,
  "data": {
    "access_id": "è®¿é—®ID",
    "signature": "ç­¾å",
    "nonce": "éšæœºæ•°",
    "timestamp": "æ—¶é—´æˆ³",
    "open_auth": "OpenAuthä»¤ç‰Œ"
  }
}</div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">è¿”å›å‚æ•°è¯´æ˜ï¼š</span>
                            <div class="flow-detail-value" style="font-size: 11px; line-height: 1.6;">â€¢ access_id (string): è®¿é—®IDï¼Œç”¨äºAPIè®¤è¯
â€¢ signature (string): HMAC-SHA256ç­¾åï¼Œç”¨äºAPIè®¤è¯
â€¢ nonce (string): éšæœºæ•°ï¼Œé˜²æ­¢é‡æ”¾æ”»å‡»
â€¢ timestamp (string): æ—¶é—´æˆ³ï¼Œç”¨äºç­¾åéªŒè¯
â€¢ open_auth (string): OpenAuthä»¤ç‰Œï¼Œç”¨äºç”¨æˆ·èº«ä»½è®¤è¯
è¿™äº›å‚æ•°ä¼šè¢«SDKè‡ªåŠ¨ä½¿ç”¨ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†</div>
                        </div>
                    </div>
                </div>

                <!-- æ­¥éª¤1 -->
                <div class="flow-step">
                    <div class="flow-step-header">
                        <div class="flow-step-number">1</div>
                        <div class="flow-step-title">è·å–è®¢å•</div>
                    </div>
                    <div class="flow-detail">
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">æ¥å£ï¼š</span>
                            <div class="flow-detail-value">POST <code>http://localhost:8080/api/order</code></div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">è¯·æ±‚å‚æ•°ï¼š</span>
                            <div class="flow-detail-value">{
  "amount": "100.00"
}</div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">è¿”å›æ•°æ®ï¼š</span>
                            <div class="flow-detail-value">{
  "code": 200,
  "message": "success",
  "data": {
    "order_no": "è®¢å•å·",
    "amount": "100.00"
  }
}</div>
                        </div>
                    </div>
                </div>

                <!-- æ­¥éª¤2 -->
                <div class="flow-step">
                    <div class="flow-step-header">
                        <div class="flow-step-number">2</div>
                        <div class="flow-step-title">è·å–é‡Šæ”¾æƒè¯å‚æ•°</div>
                    </div>
                    <div class="flow-detail">
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">æ¥å£ï¼š</span>
                            <div class="flow-detail-value">GET <code>http://localhost:8080/api/release-message/{order_no}</code></div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">è¯·æ±‚å‚æ•°ï¼š</span>
                            <div class="flow-detail-value">è·¯å¾„å‚æ•°: order_no (ä»æ­¥éª¤1è·å–çš„è®¢å•å·)</div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">è¿”å›æ•°æ®ï¼š</span>
                            <div class="flow-detail-value">{
  "code": 200,
  "message": "success",
  "data": {
    "amount": "100.00",
    "ratio": "0.1",
    "level1_ratio": "0.15",
    "level2_ratio": "0.1",
    "level1_open_id": "ä¸€åº¦ç”¨æˆ·open_id",
    "level2_open_id": "äºŒåº¦ç”¨æˆ·open_id"
  }
}</div>
                        </div>
                    </div>
                </div>

                <!-- æ­¥éª¤3 -->
                <div class="flow-step">
                    <div class="flow-step-header">
                        <div class="flow-step-number">3</div>
                        <div class="flow-step-title">è°ƒç”¨SDKé‡Šæ”¾æƒè¯</div>
                    </div>
                    <div class="flow-detail">
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">è¯´æ˜ï¼š</span>
                            <div class="flow-detail-value">è°ƒç”¨ SDK æ–¹æ³•æ—¶ï¼ŒSDK ä¼šè‡ªåŠ¨è°ƒç”¨æ­¥éª¤0ä¸­çš„ç­¾åæ¥å£è·å–è®¤è¯ä¿¡æ¯ï¼Œç„¶åå‘èµ·æƒè¯é‡Šæ”¾è¯·æ±‚ã€‚</div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">æ¥å£ï¼š</span>
                            <div class="flow-detail-value">SDKæ–¹æ³•: <code>JunDRE.EWT.ReleaseWarrant(params)</code></div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">ä¼ å…¥å‚æ•°ï¼ˆparams å¯¹è±¡ï¼‰ï¼š</span>
                            <div class="flow-detail-value">{
  "amount": "100.00",     //å¿…éœ€, æ¶ˆè´¹çš„é‡‘é¢æˆ–GOCå…‘ä»˜æ•°é‡
  "ratio": "0.1",         //å¯é€‰, ç”¨æˆ·æƒè¯æ¯”ä¾‹(æƒè¯æ•°é‡ = amount * ratio)
  "level1_ratio": "0.15", //å¯é€‰, ä¸€åº¦ç”¨æˆ·æƒè¯æ¯”ä¾‹(æƒè¯æ•°é‡ = amount * ratio * level1_ratio)
  "level2_ratio": "0.1",  //å¯é€‰, äºŒåº¦ç”¨æˆ·æƒè¯æ¯”ä¾‹(æƒè¯æ•°é‡ = amount * ratio * level2_ratio)
  "level1_open_id": "xxx",//å¯é€‰, ä¸€åº¦ç”¨æˆ· open_id
  "level2_open_id": "xxx" //å¯é€‰, äºŒåº¦ç”¨æˆ· open_id
}</div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">å“åº”å‚æ•°ï¼š</span>
                            <div class="flow-detail-value" style="font-size: 11px; line-height: 1.6;">â€¢ success (bool): æ˜¯å¦æˆåŠŸï¼Œç¤ºä¾‹: true
â€¢ errorCode (string): çŠ¶æ€ç ï¼ˆæˆåŠŸæ—¶ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œç¤ºä¾‹: ""
â€¢ errorMessage (string): é”™è¯¯ä¿¡æ¯ï¼ˆæˆåŠŸæ—¶ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œç¤ºä¾‹: ""
â€¢ json (object): ç¡®è®¤é‡Šæ”¾æƒè¯æ—¶ä½¿ç”¨ï¼Œç¤ºä¾‹: {biz_no: é•¿åº¦20çš„å­—ç¬¦ä¸²ç±»å‹}</div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">å“åº”ç¤ºä¾‹ï¼š</span>
                            <div class="flow-detail-value">{
  "success": true,        // æ˜¯å¦æˆåŠŸ
  "errorCode": "",        // çŠ¶æ€ç ï¼ˆæˆåŠŸæ—¶ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰
  "errorMessage": "",    // é”™è¯¯ä¿¡æ¯ï¼ˆæˆåŠŸæ—¶ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰
  "json": {
    "biz_no": "20250920000000000000"
  }
}</div>
                        </div>
                    </div>
                </div>

                <!-- æ­¥éª¤4 -->
                <div class="flow-step">
                    <div class="flow-step-header">
                        <div class="flow-step-number">4</div>
                        <div class="flow-step-title">ä¿å­˜ä¸šåŠ¡ç¼–å·</div>
                    </div>
                    <div class="flow-detail">
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">æ¥å£ï¼š</span>
                            <div class="flow-detail-value">POST <code>http://localhost:8080/api/ewt/release-biz-no</code></div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">è¯·æ±‚å‚æ•°ï¼š</span>
                            <div class="flow-detail-value">{
  "ewt_biz_no": "ä¸šåŠ¡ç¼–å·ï¼ˆä»æ­¥éª¤3è·å–ï¼‰",
  "order_no": "è®¢å•å·ï¼ˆä»æ­¥éª¤1è·å–ï¼‰"
}</div>
                        </div>
                        <div class="flow-detail-item">
                            <span class="flow-detail-label">è¿”å›æ•°æ®ï¼š</span>
                            <div class="flow-detail-value">{
  "code": 200,
  "message": "ä¸šåŠ¡ç¼–å·ä¿å­˜æˆåŠŸï¼Œæƒè¯é‡Šæ”¾å·²ç¡®è®¤"
}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="step-indicator" id="stepIndicator" style="display: none;">
                <div class="step" id="step1">
                    <span class="step-number">1</span>
                    <span>è·å–è®¢å•</span>
                </div>
                <div class="step" id="step2">
                    <span class="step-number">2</span>
                    <span>è·å–å‚æ•°</span>
                </div>
                <div class="step" id="step3">
                    <span class="step-number">3</span>
                    <span>é‡Šæ”¾æƒè¯</span>
                </div>
                <div class="step" id="step4">
                    <span class="step-number">4</span>
                    <span>ä¿å­˜ç¼–å·</span>
                </div>
            </div>

            <!-- è®¢å•ä¿¡æ¯å±•ç¤º -->
            <div class="section" id="orderSection" style="display: none;">
                <div class="section-title">ğŸ“¦ è®¢å•ä¿¡æ¯</div>
                <div class="info-item">
                    <span class="label">è®¢å•å·ï¼š</span>
                    <span class="value" id="orderNo">-</span>
                </div>
                <div class="info-item">
                    <span class="label">è®¢å•é‡‘é¢ï¼š</span>
                    <span class="value" id="orderAmount">-</span>
                </div>
            </div>

            <!-- æƒè¯é‡Šæ”¾å‚æ•°å±•ç¤º -->
            <div class="section" id="paramsSection" style="display: none;">
                <div class="section-title">âš™ï¸ é‡Šæ”¾å‚æ•°</div>
                <div class="info-item">
                    <span class="label">é‡‘é¢ï¼š</span>
                    <span class="value" id="paramAmount">-</span>
                </div>
                <div class="info-item">
                    <span class="label">å¥–åŠ±æ¯”ä¾‹ï¼š</span>
                    <span class="value" id="paramRatio">-</span>
                </div>
                <div class="info-item">
                    <span class="label">ä¸€åº¦æ¯”ä¾‹ï¼š</span>
                    <span class="value" id="paramLevel1Ratio">-</span>
                </div>
                <div class="info-item">
                    <span class="label">äºŒåº¦æ¯”ä¾‹ï¼š</span>
                    <span class="value" id="paramLevel2Ratio">-</span>
                </div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="button-group">
                <button class="btn btn-primary" id="releaseBtn" onclick="handleReleaseWarrant()">
                    <span id="btnText">é‡Šæ”¾æƒè¯</span>
                </button>
                <button class="btn btn-secondary" onclick="handleReset()">é‡ç½®</button>
            </div>

            <!-- ç»“æœæ˜¾ç¤º -->
            <div class="section" id="resultSection" style="display: none;">
                <div class="section-title">ğŸ“Š æ‰§è¡Œç»“æœ</div>
                <div class="result-box" id="resultBox">
                    <div class="result-item">
                        <span class="label">çŠ¶æ€ï¼š</span>
                        <span class="value" id="resultStatus">-</span>
                    </div>
                    <div class="result-item" id="bizNoItem" style="display: none;">
                        <span class="label">ä¸šåŠ¡ç¼–å·ï¼š</span>
                        <span class="value" id="resultBizNo">-</span>
                    </div>
                    <div class="result-item" id="errorItem" style="display: none;">
                        <span class="label">é”™è¯¯ä¿¡æ¯ï¼š</span>
                        <span class="value" id="resultError">-</span>
                    </div>
                </div>
            </div>

            <!-- æ§åˆ¶å°æ—¥å¿— -->
            <div class="section">
                <div class="section-title">ğŸ“ æ‰§è¡Œæ—¥å¿—</div>
                <div class="console-log" id="consoleLog">
                    <div class="log-item">
                        <span class="log-time">[ç­‰å¾…æ“ä½œ]</span>
                        <span class="log-info">ç‚¹å‡»"é‡Šæ”¾æƒè¯"æŒ‰é’®å¼€å§‹æµç¨‹</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // SDK åˆå§‹åŒ–çŠ¶æ€
        let sdkInitialized = false;

        // åˆå§‹åŒ– JunYou SDK
        async function initJunYouSDK() {
            if (!window.JunDRE) {
                addLog('âš ï¸ JunYou SDK æœªåŠ è½½', 'error');
                return;
            }

            try {
                // å®šä¹‰ jySdkFn å‡½æ•°ï¼Œç”¨äºè·å–ç­¾åå’Œä»¤ç‰Œ
                const customMethods = {
                    jySdkFn: async (params) => {
                        addLog(`ğŸ“ SDK è¯·æ±‚ç­¾å: ${params.method} ${params.path}`, 'info');
                        
                        try {
                            // è°ƒç”¨åç«¯æ¥å£è·å–ç­¾åï¼ˆopen_id åœ¨åç«¯å†™æ­»ï¼‰
                            addLog('ğŸ“ è°ƒç”¨åç«¯æ¥å£è·å–ç­¾å...', 'info');
                            
                            const signRes = await apiRequest(`${API_BASE_URL}/signature-with-open-auth`, {
                                method: 'POST',
                                body: JSON.stringify({
                                    method: params.method,
                                    path: params.path
                                })
                            });

                            if (signRes.code !== 200) {
                                throw new Error(signRes.message || 'è·å–ç­¾åå¤±è´¥');
                            }

                            // ä»å“åº”ä¸­æå–ç­¾åä¿¡æ¯
                            const { access_id, signature, nonce, timestamp, open_auth } = {
                                access_id: signRes.data.access_id,
                                signature: signRes.data.signature,
                                nonce: signRes.data.nonce,
                                timestamp: signRes.data.timestamp,
                                open_auth: signRes.data.open_auth
                            };

                            // è¿”å› SDK éœ€è¦çš„æ ¼å¼ï¼ˆheaders å¯¹è±¡ï¼‰
                            const authHeaders = {
                                'X-Access-ID': access_id,
                                'X-Signature': signature,
                                'X-Signature-Nonce': nonce,
                                'X-Timestamp': timestamp,
                                'X-Open-Auth': open_auth,
                            };

                            // æ‰“å° authHeaders
                            console.log('ğŸ“‹ Auth Headers:', authHeaders);
                            addLog('ğŸ“‹ Auth Headers: ' + JSON.stringify(authHeaders, null, 2), 'info');

                            addLog('âœ… ç­¾åè·å–æˆåŠŸ', 'success');
                            return authHeaders;
                        } catch (error) {
                            addLog('âŒ è·å–ç­¾åå¤±è´¥: ' + error.message, 'error');
                            throw error;
                        }
                    }
                };

                // åˆå§‹åŒ– SDK
                window.JunDRE.init({
                    methods: customMethods
                });

                sdkInitialized = true;
                addLog('âœ… JunYou SDK åˆå§‹åŒ–æˆåŠŸ', 'success');
            } catch (error) {
                addLog('âŒ SDK åˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
                console.error('SDK åˆå§‹åŒ–é”™è¯¯:', error);
            }
        }

        // API åŸºç¡€é…ç½®
        const API_BASE_URL = 'http://localhost:8080/api';

        // é€šç”¨ API è¯·æ±‚å‡½æ•°
        async function apiRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data;
            } catch (error) {
                console.error('API è¯·æ±‚å¤±è´¥:', error);
                throw error;
            }
        }

        // API è°ƒç”¨
        async function userOrderApi(params = {}) {
            addLog('æ­¥éª¤1: è°ƒç”¨è·å–è®¢å•æ¥å£...', 'info');
            try {
                const response = await apiRequest(`${API_BASE_URL}/order`, {
                    method: 'POST',
                    body: JSON.stringify({ amount: params.amount || '100.00' })
                });
                addLog('âœ… è®¢å•è·å–æˆåŠŸ', 'success');
                return response;
            } catch (error) {
                addLog('âŒ è®¢å•è·å–å¤±è´¥: ' + error.message, 'error');
                throw error;
            }
        }

        async function ReleaseMessageApi(params) {
            addLog('æ­¥éª¤2: è°ƒç”¨è·å–é‡Šæ”¾æƒè¯æ•°æ®æ¥å£...', 'info');
            try {
                const response = await apiRequest(`${API_BASE_URL}/release-message/${params.order_no}`, {
                    method: 'GET'
                });
                addLog('âœ… é‡Šæ”¾æƒè¯æ•°æ®è·å–æˆåŠŸ', 'success');
                return response;
            } catch (error) {
                addLog('âŒ é‡Šæ”¾æƒè¯æ•°æ®è·å–å¤±è´¥: ' + error.message, 'error');
                throw error;
            }
        }

        async function storeEwtReleaseBizNoApi(params) {
            addLog('æ­¥éª¤4: è°ƒç”¨å­˜å‚¨ä¸šåŠ¡ç¼–å·æ¥å£ï¼ˆä¼šè°ƒç”¨SDKç¡®è®¤æƒè¯é‡Šæ”¾ï¼‰...', 'info');
            try {
                const response = await apiRequest(`${API_BASE_URL}/ewt/release-biz-no`, {
                    method: 'POST',
                    body: JSON.stringify({
                        ewt_biz_no: params.ewt_biz_no,
                        order_no: params.order_no
                    })
                });
                addLog('âœ… ä¸šåŠ¡ç¼–å·ä¿å­˜æˆåŠŸï¼Œæƒè¯é‡Šæ”¾å·²ç¡®è®¤', 'success');
                return response;
            } catch (error) {
                addLog('âŒ ä¸šåŠ¡ç¼–å·ä¿å­˜å¤±è´¥: ' + error.message, 'error');
                throw error;
            }
        }

        // æ£€æŸ¥åç«¯æœåŠ¡è¿æ¥
        async function checkBackendConnection() {
            const statusEl = document.getElementById('apiStatus');
            if (!statusEl) return;
            
            try {
                const response = await fetch('http://localhost:8080/health', {
                    method: 'GET',
                    signal: AbortSignal.timeout(3000) // 3ç§’è¶…æ—¶
                });
                if (response.ok) {
                    statusEl.textContent = 'âœ… åç«¯æœåŠ¡å·²è¿æ¥';
                    statusEl.style.background = 'rgba(76, 175, 80, 0.3)';
                } else {
                    throw new Error('æœåŠ¡ä¸å¯ç”¨');
                }
            } catch (error) {
                statusEl.textContent = 'âš ï¸ åç«¯æœåŠ¡æœªè¿æ¥';
                statusEl.style.background = 'rgba(255, 152, 0, 0.3)';
                console.warn('åç«¯æœåŠ¡ä¸å¯ç”¨');
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', async () => {
            // æ£€æŸ¥åç«¯è¿æ¥
            await checkBackendConnection();
            
            // åˆå§‹åŒ– JunYou SDK
            await initJunYouSDK();
            
            // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡è¿æ¥çŠ¶æ€
            setInterval(checkBackendConnection, 30000);
        });

        // å·¥å…·å‡½æ•°
        const MAX_LOG_ITEMS = 100; // æœ€å¤§æ—¥å¿—æ¡æ•°
        function addLog(message, type = 'info') {
            const consoleLog = document.getElementById('consoleLog');
            const logItem = document.createElement('div');
            logItem.className = 'log-item';
            
            const time = new Date().toLocaleTimeString();
            const logClass = type === 'error' ? 'log-error' : (type === 'success' ? 'log-success' : 'log-info');
            
            logItem.innerHTML = `
                <span class="log-time">[${time}]</span>
                <span class="${logClass}">${message}</span>
            `;
            
            consoleLog.appendChild(logItem);
            
            // é™åˆ¶æ—¥å¿—æ¡æ•°ï¼Œé˜²æ­¢æ— é™å¢é•¿
            const logItems = consoleLog.querySelectorAll('.log-item');
            if (logItems.length > MAX_LOG_ITEMS) {
                // åˆ é™¤æœ€æ—§çš„æ—¥å¿—ï¼ˆä¿ç•™ç¬¬ä¸€æ¡æç¤ºä¿¡æ¯ï¼‰
                for (let i = 1; i < logItems.length - MAX_LOG_ITEMS + 1; i++) {
                    logItems[i].remove();
                }
            }
            
            consoleLog.scrollTop = consoleLog.scrollHeight;
            
            // æ§åˆ¶å°ä¹Ÿè¾“å‡º
            console.log(`[${time}] ${message}`);
        }

        function updateStep(stepNum) {
            for (let i = 1; i <= 4; i++) {
                const stepEl = document.getElementById(`step${i}`);
                if (i <= stepNum) {
                    stepEl.classList.add('active');
                } else {
                    stepEl.classList.remove('active');
                }
            }
        }

        // ä¸»è¦å¤„ç†å‡½æ•°
        async function handleReleaseWarrant() {
            try {
                const releaseBtn = document.getElementById('releaseBtn');
                const btnText = document.getElementById('btnText');
                
                releaseBtn.disabled = true;
                btnText.innerHTML = '<span class="loading"></span>å¤„ç†ä¸­...';
                
                // æ˜¾ç¤ºæ­¥éª¤æŒ‡ç¤ºå™¨
                document.getElementById('stepIndicator').style.display = 'flex';
                updateStep(0);
                
                // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
                document.getElementById('resultSection').style.display = 'none';
                document.getElementById('orderSection').style.display = 'none';
                document.getElementById('paramsSection').style.display = 'none';
                
                // 1. è·å–è®¢å•ä¿¡æ¯
                updateStep(1);
                let orderRes;
                try {
                    orderRes = await userOrderApi({});
                } catch (error) {
                    addLog('âŒ è·å–è®¢å•å¤±è´¥: ' + error.message, 'error');
                    showError('è·å–è®¢å•å¤±è´¥: ' + error.message);
                    return;
                }

                const { code, data } = orderRes;

                if (code !== 200) {
                    addLog('âŒ è·å–è®¢å•å¤±è´¥: ' + (orderRes.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                    showError(orderRes.message || 'è·å–è®¢å•å¤±è´¥');
                    return;
                }

                if (!data || !data.order_no) {
                    addLog('âŒ è®¢å•æ•°æ®æ ¼å¼é”™è¯¯', 'error');
                    showError('è®¢å•æ•°æ®æ ¼å¼é”™è¯¯');
                    return;
                }

                addLog('âœ… è®¢å•è·å–æˆåŠŸ: ' + data.order_no, 'success');
                
                // æ˜¾ç¤ºè®¢å•ä¿¡æ¯
                document.getElementById('orderNo').textContent = data.order_no;
                document.getElementById('orderAmount').textContent = 'Â¥' + data.amount;
                document.getElementById('orderSection').style.display = 'block';

                // 2. è·å–é‡Šæ”¾æƒè¯æ•°æ®
                updateStep(2);
                let MessageRes;
                try {
                    MessageRes = await ReleaseMessageApi({
                        order_no: data.order_no
                    });
                } catch (error) {
                    addLog('âŒ è·å–é‡Šæ”¾æƒè¯æ•°æ®å¤±è´¥: ' + error.message, 'error');
                    showError('è·å–é‡Šæ”¾æƒè¯æ•°æ®å¤±è´¥: ' + error.message);
                    return;
                }

                if (MessageRes.code !== 200) {
                    addLog('âŒ è·å–é‡Šæ”¾æƒè¯æ•°æ®å¤±è´¥: ' + (MessageRes.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                    showError(MessageRes.message || 'è·å–é‡Šæ”¾æƒè¯æ•°æ®å¤±è´¥');
                    return;
                }

                if (!MessageRes.data) {
                    addLog('âŒ é‡Šæ”¾æƒè¯æ•°æ®æ ¼å¼é”™è¯¯', 'error');
                    showError('é‡Šæ”¾æƒè¯æ•°æ®æ ¼å¼é”™è¯¯');
                    return;
                }

                addLog('âœ… é‡Šæ”¾æƒè¯æ•°æ®è·å–æˆåŠŸ', 'success');
                
                // æ˜¾ç¤ºé‡Šæ”¾å‚æ•°
                const params = MessageRes.data;
                document.getElementById('paramAmount').textContent = params.amount;
                document.getElementById('paramRatio').textContent = params.ratio;
                document.getElementById('paramLevel1Ratio').textContent = params.level1_ratio;
                document.getElementById('paramLevel2Ratio').textContent = params.level2_ratio;
                document.getElementById('paramsSection').style.display = 'block';

                // 3. è°ƒç”¨ SDK ReleaseWarrant
                updateStep(3);
                addLog('æ­¥éª¤3: è°ƒç”¨ SDK ReleaseWarrant...', 'info');
                
                if (!sdkInitialized || !window.JunDRE) {
                    throw new Error('SDK æœªåˆå§‹åŒ–ï¼Œè¯·ç¡®ä¿ JunYou SDK å·²æ­£ç¡®åŠ è½½');
                }
                
                addLog('ğŸ“ è°ƒç”¨ JunYou SDK', 'info');
                
                // ReleaseWarrant æ˜¯å¼‚æ­¥æ–¹æ³•ï¼Œè¿”å› Promise
                const Result = await window.JunDRE.EWT.ReleaseWarrant({ ...MessageRes.data });

                // è¾“å‡ºå®Œæ•´çš„è¿”å›ç»“æœç”¨äºè°ƒè¯•
                console.log('SDK ReleaseWarrant è¿”å›ç»“æœ:', Result);
                addLog('ğŸ“‹ SDK è¿”å›ç»“æœ: ' + JSON.stringify(Result, null, 2), 'info');

                if (!Result.success) {
                    // æ„å»ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                    const errorDetails = [];
                    if (Result.errorCode) {
                        errorDetails.push(`é”™è¯¯ä»£ç : ${Result.errorCode}`);
                    }
                    if (Result.errorMessage) {
                        errorDetails.push(`é”™è¯¯ä¿¡æ¯: ${Result.errorMessage}`);
                    }
                    if (Result.detail) {
                        errorDetails.push(`è¯¦ç»†ä¿¡æ¯: ${JSON.stringify(Result.detail)}`);
                    }
                    
                    const fullErrorMsg = errorDetails.length > 0 
                        ? errorDetails.join(' | ')
                        : 'æœªçŸ¥é”™è¯¯';
                    
                    addLog('âŒ æƒè¯é¢„ç”³è¯·é‡Šæ”¾å¤±è´¥: ' + fullErrorMsg, 'error');
                    showError(fullErrorMsg);
                    return;
                }

                // SDK è¿”å›çš„ç»“æœç»“æ„å¯èƒ½ä¸åŒï¼Œéœ€è¦æ ¹æ®å®é™…è¿”å›è°ƒæ•´
                // æ ¹æ® SDK æºç ï¼Œè¿”å›çš„æ˜¯ dataProcessing çš„ç»“æœ
                // éœ€è¦ä»è¿”å›ç»“æœä¸­æå–ä¸šåŠ¡ç¼–å·
                const bizNo = Result.biz_no || Result.data?.biz_no || Result.json?.biz_no;
                
                if (!bizNo) {
                    addLog('âš ï¸ è­¦å‘Š: æœªæ‰¾åˆ°ä¸šåŠ¡ç¼–å·ï¼Œè¿”å›ç»“æœ: ' + JSON.stringify(Result), 'info');
                    // å¦‚æœSDKè¿”å›çš„æ˜¯iframeå¤„ç†ç»“æœï¼Œå¯èƒ½éœ€è¦ä»å…¶ä»–å­—æ®µè·å–
                    addLog('âœ… æƒè¯é‡Šæ”¾æµç¨‹å®Œæˆ', 'success');
                    showSuccess('æµç¨‹å®Œæˆï¼ˆè¯·æŸ¥çœ‹è¿”å›ç»“æœï¼‰');
                    return;
                }

                addLog('âœ… æƒè¯é‡Šæ”¾æˆåŠŸï¼Œä¸šåŠ¡ç¼–å·: ' + bizNo, 'success');

                // 4. å­˜å‚¨ä¸šåŠ¡ç¼–å·ï¼ˆä¼šè°ƒç”¨SDKç¡®è®¤æƒè¯é‡Šæ”¾ï¼‰
                updateStep(4);
                let storeResult;
                try {
                    storeResult = await storeEwtReleaseBizNoApi({
                        ewt_biz_no: bizNo,
                        order_no: data.order_no,
                    });
                } catch (error) {
                    addLog('âŒ å­˜å‚¨ä¸šåŠ¡ç¼–å·å¤±è´¥: ' + error.message, 'error');
                    showError('å­˜å‚¨ä¸šåŠ¡ç¼–å·å¤±è´¥: ' + error.message);
                    return;
                }

                if (storeResult.code !== 200) {
                    addLog('âŒ å­˜å‚¨ä¸šåŠ¡ç¼–å·å¤±è´¥: ' + (storeResult.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                    showError(storeResult.message || 'å­˜å‚¨ä¸šåŠ¡ç¼–å·å¤±è´¥');
                    return;
                }

                addLog('âœ… ä¸šåŠ¡ç¼–å·ä¿å­˜æˆåŠŸ', 'success');
                addLog('ğŸ‰ æƒè¯é‡Šæ”¾æµç¨‹å®Œæˆï¼', 'success');

                // æ˜¾ç¤ºæˆåŠŸç»“æœ
                showSuccess(bizNo);
                
                updateStep(4);

            } catch (error) {
                console.error('æƒè¯æµç¨‹é”™è¯¯:', error);
                addLog('âŒ å‘ç”Ÿé”™è¯¯: ' + error.message, 'error');
                showError(error.message || 'æœªçŸ¥é”™è¯¯');
            } finally {
                const releaseBtn = document.getElementById('releaseBtn');
                const btnText = document.getElementById('btnText');
                releaseBtn.disabled = false;
                btnText.textContent = 'é‡Šæ”¾æƒè¯';
            }
        }

        function showSuccess(bizNo) {
            const resultSection = document.getElementById('resultSection');
            const resultBox = document.getElementById('resultBox');
            const resultStatus = document.getElementById('resultStatus');
            const bizNoItem = document.getElementById('bizNoItem');
            const resultBizNo = document.getElementById('resultBizNo');
            const errorItem = document.getElementById('errorItem');
            
            resultBox.className = 'result-box success';
            resultStatus.textContent = 'æˆåŠŸ';
            resultBizNo.textContent = bizNo;
            bizNoItem.style.display = 'flex';
            errorItem.style.display = 'none';
            resultSection.style.display = 'block';
        }

        function showError(errorMessage) {
            const resultSection = document.getElementById('resultSection');
            const resultBox = document.getElementById('resultBox');
            const resultStatus = document.getElementById('resultStatus');
            const errorItem = document.getElementById('errorItem');
            const resultError = document.getElementById('resultError');
            const bizNoItem = document.getElementById('bizNoItem');
            
            resultBox.className = 'result-box error';
            resultStatus.textContent = 'å¤±è´¥';
            resultError.textContent = errorMessage;
            errorItem.style.display = 'flex';
            bizNoItem.style.display = 'none';
            resultSection.style.display = 'block';
        }

        function handleReset() {
            // é‡ç½®æ‰€æœ‰çŠ¶æ€
            document.getElementById('orderSection').style.display = 'none';
            document.getElementById('paramsSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('stepIndicator').style.display = 'none';
            
            // æ¸…ç©ºæ—¥å¿—ï¼ˆä¿ç•™ç¬¬ä¸€æ¡ï¼‰
            const consoleLog = document.getElementById('consoleLog');
            consoleLog.innerHTML = `
                <div class="log-item">
                    <span class="log-time">[ç­‰å¾…æ“ä½œ]</span>
                    <span class="log-info">ç‚¹å‡»"é‡Šæ”¾æƒè¯"æŒ‰é’®å¼€å§‹æµç¨‹</span>
                </div>
            `;
            
            addLog('ğŸ”„ å·²é‡ç½®ï¼Œå¯ä»¥é‡æ–°å¼€å§‹', 'info');
        }
    </script>
</body>
</html>

